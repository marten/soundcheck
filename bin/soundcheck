#!/usr/bin/env ruby
require 'optparse'
require 'soundcheck'

options = {}
option_parser = OptionParser.new do |opts|
  opts.banner = "Usage: soundcheck [options] [file or path]"

  opts.on("--fast", "Run fast specs only") do
    options[:fast] = true
  end

  opts.on("--trace", "Shows backtrace") do
    options[:trace] = true
  end

  opts.on("-v", "--verbose", "Shows debug information about language/test-framework detection") do
    options[:verbose] = true
  end

  opts.on("--help", "Show this info") do
    puts opts
    exit
  end
end

option_parser.parse!(ARGV)
soundcheck = Soundcheck.new(ARGV[0], options)

begin
  cmd = soundcheck.command_to_run
  puts cmd
  exec cmd
rescue Project::UnknownLanguage
  puts "Error: Cannot detect the programming language for this project."
  exit 1
rescue Project::UnknownFramework
  puts "Error: Cannot detect the test framework for this project."
  exit 1
end
